<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script> delete AFRAME.components["grabbable"]; </script>
    <script src="https://unpkg.com/aframe-environment-component@1.5.x/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@c-frame/aframe-physics-system@4.2.2/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.x/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/super-hands@3.0.5/dist/super-hands.min.js"></script>
  </head>
  <body>
    <a-scene physics="debug: false">
      <!-- Contrôleur de main -->
      <a-entity id="rightHand" hand-controls="hand: right"></a-entity>
      
      <!-- Objet à saisir -->
      <a-box id="grabBox"
            position="0 1.25 -2"
            color="#E95C4B"
            dynamic-body></a-box>
      
      <a-plane position="0 0 -4"
              rotation="-90 0 0"
              width="10"
              height="10"
              color="#7BC8A4"
              static-body></a-plane>
    </a-scene>
    
  </body>

  <script>
    const hand = document.getElementById('rightHand');
    const box = document.getElementById('grabBox');
    let grabbing = false;

    // Lorsque la gâchette est pressée, on "grab"
    hand.addEventListener('triggerdown', function () {
      // Vérifier si la main et la box sont proches
      const handPos = hand.object3D.position;
      const boxPos = box.object3D.position;
      const distance = handPos.distanceTo(boxPos);
      if (distance < 0.5) { // rayon de détection
        grabbing = true;
        box.setAttribute('dynamic-body', 'mass', 0); // la box n'est plus physique
      }
    });

    hand.addEventListener('triggerup', function () {
      grabbing = false;
      box.setAttribute('dynamic-body', 'mass', 1); // la box redevient physique
    });

    // Synchronisation de la position
    hand.sceneEl.addEventListener('renderstart', function () {
      hand.sceneEl.addEventListener('tick', function () {
        if (grabbing) {
          box.object3D.position.copy(hand.object3D.position);
        }
      });
    });
  </script>
</html>
